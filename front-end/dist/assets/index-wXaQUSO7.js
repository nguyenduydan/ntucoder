import{j as e,an as v,ae as q,ah as Q,ai as Z,E as J,r,s as y,aX as U,a$ as ee,aZ as T,b0 as I,aY as te,a_ as f,x as u,a8 as $,aB as se,D as C,ac as P,y as ae,bl as oe,ab as L,l as ne,u as re,bm as ie,K as le,Q as ce,bn as de,P as xe,i as N}from"./index-NsYg9CFQ.js";import{S as k}from"./skeleton-text-DPG-mtU0.js";const A=({size:o="2rem",...t})=>e.jsx(v,{borderRadius:"full",boxSize:o,...t});A.displayName="SkeletonCircle";const me=q((o,t)=>{const{overflow:d,overflowX:m,className:i,...l}=o;return e.jsx(Q.div,{ref:t,className:Z("chakra-table__container",i),...l,__css:{display:"block",whiteSpace:"nowrap",WebkitOverflowScrolling:"touch",overflowX:d??m??"auto",overflowY:"hidden",maxWidth:"100%"}})}),R=7*24*60*60*1e3,he=({coders:o,loading:t,currentPage:d=1,pageSize:m=10,onReset:i})=>{const{coder:l}=J(),S=(l==null?void 0:l.coderID)||"",[j,h]=r.useState(0);r.useEffect(()=>{let s=localStorage.getItem("rankingResetTime");s?s=parseInt(s,10):(s=Date.now()+R,localStorage.setItem("rankingResetTime",s));const a=()=>{const c=Date.now(),b=s-c;if(b<=0){const w=c+R;localStorage.setItem("rankingResetTime",w),h(R),i&&typeof i=="function"&&i()}else h(b)};a();const x=setInterval(a,1e3);return()=>clearInterval(x)},[i]);const g=s=>{const a=Math.floor(s/1e3),x=Math.floor(a/(24*3600)),c=Math.floor(a%(24*3600)/3600),b=Math.floor(a%3600/60),w=a%60;return`${x} ngày ${c.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`};return e.jsxs(y,{minH:"40vh",overflowX:"auto",children:[e.jsxs(y,{mb:4,p:2,bg:"blue.50",borderRadius:"md",textAlign:"center",fontWeight:"semibold",color:"blue.700",children:["Reset bảng xếp hạng trong: ",g(j)]}),e.jsx(me,{overflowX:"auto",children:e.jsxs(U,{size:"sm",colorScheme:"blue",minW:"320px",children:[e.jsx(ee,{bg:"gray.100",position:"sticky",top:0,zIndex:1,children:e.jsxs(T,{children:[e.jsx(I,{w:"20px",py:[2,3],fontSize:["xs","sm"],children:"#"}),e.jsx(I,{ps:[2,5],fontSize:["sm","md"],children:"Tên người dùng"}),e.jsx(I,{ps:[2,5],fontSize:["sm","md"],children:"Điểm"})]})}),e.jsx(te,{children:t?Array.from({length:5}).map((s,a)=>e.jsxs(T,{children:[e.jsx(f,{py:[2,4],children:e.jsx(v,{height:"20px"})}),e.jsx(f,{py:[2,4],children:e.jsxs(u,{align:"center",gap:3,children:[e.jsx(A,{size:["6","8"]}),e.jsx(k,{noOfLines:1,width:"120px"})]})}),e.jsx(f,{py:[2,4],children:e.jsx(v,{height:"20px",width:"60px"})})]},`skeleton-${a}`)):Array.isArray(o)&&o.length>0?o.map((s,a)=>e.jsxs(T,{bg:s.coderID===S?"blue.300":"white",children:[e.jsx(f,{py:[2,4],fontWeight:"bold",fontSize:["xs","sm"],children:(d-1)*m+a+1}),e.jsx(f,{py:[2,4],children:e.jsx($,{to:`/profile/${s.coderID}`,children:e.jsxs(u,{alignItems:"center",gap:3,_hover:{color:"blue.600",transform:"scale(1.02)"},transition:"all .2s ease-in-out",children:[e.jsx(se,{name:s.coderName||"Coder",src:s.avatar,size:["xs","sm"],loading:"lazy"}),e.jsx(C,{fontWeight:"bold",fontSize:["sm","md"],children:s.coderName})]})})}),e.jsx(f,{py:[2,4],children:e.jsxs(P,{fontSize:["xs","sm"],colorScheme:"green",children:[s.totalPoint," điểm"]})})]},s.coderID)):e.jsx(T,{children:e.jsx(f,{colSpan:3,py:[6,8],textAlign:"center",fontSize:["sm","md"],children:e.jsx(C,{fontStyle:"italic",color:"gray.500",children:"Không có dữ liệu để hiển thị."})})})})]})})]})},D=({coder:o,rank:t,gradient:d,crown:m=!1,isLoading:i=!1})=>{const l=!!o,S=t===1?{base:"90vw",sm:"350px",md:"400px"}:{base:"70vw",sm:"300px",md:"300px"},j=t===1?{base:4,sm:5,md:6}:{base:4,sm:4,md:4},h=t===1?{base:"lg",sm:"lg",md:"2xl"}:{base:"lg",sm:"lg",md:"xl"},g=t===1?{base:3,sm:4}:{base:3,sm:4},s=t===1?{base:3,sm:4}:{base:3,sm:4},a=t===1?{base:"-24px",sm:"-28px",md:"-32px"}:{base:"-24px",sm:"-28px",md:"-32px"},x=t===1?{base:"lg",sm:"md"}:{base:"md",sm:"sm"},c=t===1?{base:"md",sm:"lg"}:{base:"sm",sm:"sm"};return e.jsxs(ae,{bgGradient:d,borderRadius:"md",p:j,shadow:t===1?"2xl":"md",width:S,minH:t===1?"auto":"100px",_hover:{shadow:t===1?"4xl":"lg",transform:t===1?"scale(1.07)":"scale(1.05)",...t===1&&{boxShadow:"0 0 20px 4px rgba(255, 223, 71, 0.9)"}},transition:"all 0.3s ease",position:"relative",children:[m&&!i&&e.jsx(y,{position:"absolute",top:a,color:"yellow.400",fontSize:{base:"4xl",sm:"5xl",md:"6xl"},children:e.jsx(oe,{})}),e.jsxs(P,{colorScheme:"yellow",position:"absolute",top:g,right:s,fontSize:c,px:t===1?{base:2,sm:3}:{base:2,sm:3},borderRadius:"full",children:["#",t]}),i?e.jsxs(e.Fragment,{children:[e.jsx(A,{size:"100px",mb:2}),e.jsx(k,{noOfLines:1,width:"80px",mb:2})]}):l?e.jsx($,{to:`/profile/${o.coderID}`,children:e.jsxs(u,{flexDirection:"column",align:"center",mb:2,children:[e.jsx(L,{size:h,name:o.coderName,src:o.avatar,mb:2}),e.jsx(C,{fontWeight:"bold",fontSize:x,textAlign:"center",children:o.coderName})]})}):e.jsxs(u,{flexDirection:"column",align:"center",mb:2,children:[e.jsx(L,{size:h,name:"Chưa có người dùng",mb:2}),e.jsx(C,{fontWeight:"bold",fontSize:x,children:"Chưa có người dùng"})]}),i?e.jsx(v,{height:"30px",width:"60px",borderRadius:"full"}):e.jsx(P,{fontSize:c,colorScheme:"teal",fontWeight:"semibold",children:l?`${o.totalPoint} điểm`:"0 điểm"})]})},fe=()=>{ne("Ranking");const o=re(),[t,d]=r.useState(!1),[m,i]=r.useState(!1),[l,S]=r.useState([]),[j,h]=r.useState([]),[g,s]=r.useState(1),[a,x]=r.useState(10),[c,b]=r.useState(0),[w,H]=r.useState(0),[W,X]=r.useState(""),_=ie(W,500),E=async()=>{d(!0);try{const n=await N.get("/Coder/top-hightest");n.status===200&&S(n.data)}catch(n){console.error("Failed to fetch top 3 coders:",n),o({title:"Failed to fetch data",description:n.message,status:"error",duration:2e3,isClosable:!0,variant:"top-accent",position:"top"})}finally{d(!1)}},z=async(n=1,K=10,V="")=>{i(!0);try{const p=await N.get("/Coder/list-ranking",{params:{page:n,pageSize:K,q:V}});p.status===200&&(h(p.data.data),b(p.data.totalPages),H(p.data.totalCount))}catch(p){console.error("Failed to fetch top 3 coders:",p),o({title:"Failed to fetch data",description:p.message,status:"error",duration:2e3,isClosable:!0,variant:"top-accent",position:"top"})}finally{i(!1)}};r.useEffect(()=>{E()},[]),r.useEffect(()=>{z(g,a,_)},[_,g,a]);const[M,B,O]=l,Y=n=>{s(n),z(n,a)},G=n=>{x(n),s(1),z(1,n)},F=()=>{E(),z(1,a)};return r.useEffect(()=>{F()},[]),e.jsxs(le,{maxW:["100vw","container.md","container.xl"],minH:"90vh",p:[6,0],bg:"gray.200",overflowX:"hidden",children:[e.jsxs(y,{bgGradient:"linear(to-r, purple.500, blue.500)",p:[4,6],borderRadius:"md",mb:8,boxShadow:"md",children:[e.jsx(ce,{mb:8,textAlign:"center",fontSize:["3xl","4xl","5xl"],fontWeight:"extrabold",letterSpacing:"wide",textTransform:"uppercase",color:"green.500",textShadow:"2px 4px 3px rgb(22, 56, 9), 0 1px 20px #fff",children:"Ranking"}),e.jsxs(u,{justify:"center",align:"flex-end",gap:[4,6,10],flexDirection:["column","row"],children:[e.jsx(D,{coder:B,rank:2,gradient:"linear(to-br, green.800, green.500, green.300)",isLoading:t,size:["md","lg","xl"]}),e.jsx(D,{coder:M,rank:1,gradient:"linear(to-br, yellow.800, yellow.500, yellow.300)",crown:!0,size:["lg","2xl","3xl"],isLoading:t,mt:[4,0]}),e.jsx(D,{coder:O,rank:3,gradient:"linear(to-br, blue.800, blue.500, blue.300)",isLoading:t,size:["md","lg","xl"]})]})]}),e.jsxs(y,{bg:"white",p:[4,6],borderRadius:"md",shadow:"md",mb:8,minH:"50vh",children:[e.jsx(u,{justify:"flex-start",mb:8,flexDirection:["column","row"],alignItems:["stretch","center"],gap:[4,0],children:e.jsx(de,{type:"text",placeholder:"Tìm người dùng...",value:W,onChange:n=>{X(n.target.value),s(1)},borderRadius:"full",boxShadow:"md",borderWidth:"1px",w:["100%","300px"]})}),e.jsx(he,{coders:j,loading:m,onReset:F}),e.jsx(xe,{currentPage:g,totalPages:c,totalRows:w,onPageChange:Y,pageSize:a,onPageSizeChange:G,mt:4})]})]})};export{fe as default};
