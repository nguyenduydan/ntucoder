import{U as L,r as c,j as e,V as q,W as w,X as z,Y as A,Z as N,_ as W,$ as B,a0 as D,a1 as m,a2 as P,f as K,a6 as F,i as T,a7 as H,a8 as O,a9 as M,a4 as Q,aj as R,af as V,ag as U,B as G}from"./react-vendor-B0lTxKSL.js";import{a as X,A as Y,d as Z,u as _,g as E,S as $,T as J,C as ee,P as te}from"./index-CfmnNlTN.js";import{aA as se}from"./vendor-C1WdaeOg.js";import"./charts-vendor-DwxpLNbD.js";import"./lodash-vendor-CBiJWk4A.js";import"./axios-vendor-xsH4HHeE.js";import"./moment-vendor-CTDujYFw.js";function ae({isOpen:r,onClose:g,fetchData:j,problemID:b}){const d=L(),[x,n]=c.useState(!1),C=c.useMemo(()=>({testCaseOrder:"",sampleTest:0,preTest:0,input:"",output:""}),[]),[a,u]=c.useState(C);c.useEffect(()=>{r||u(C)},[r,C]);const o=t=>{u({...a,[t.target.name]:t.target.value})},h=(t,s)=>{u(p=>({...p,[t]:s?1:0}))},i=(t,s)=>{const p=t.target.files[0];if(p){const f=new FileReader;f.onload=S=>{u(I=>({...I,[s]:S.target.result}))},f.readAsText(p)}},y=async()=>{if(!a.testCaseOrder||!a.output){d({title:"Lỗi",description:"Không được để trống.",status:"error",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"});return}if(isNaN(a.testCaseOrder)||parseInt(a.testCaseOrder)<=0){d({title:"Lỗi",description:"TestCase Order phải là số nguyên lớn hơn 0.",status:"error",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"});return}try{n(!0);const t=await X.post("/TestCase",{...a,problemID:b});if(t.status===200||t.status===201)d({title:"Thêm mới bài toán thành công!",status:"success",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"}),g(),j();else throw new Error("Có lỗi xảy ra khi thêm mới.")}catch(t){d({title:"Đã xảy ra lỗi.",description:t.message||"Có lỗi xảy ra khi tạo bài toán.",status:"error",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"})}finally{n(!1)}};return e.jsxs(q,{size:"2xl",isOpen:r,onClose:g,children:[e.jsx(w,{}),e.jsxs(z,{children:[e.jsx(A,{children:"Thêm TestCase mới"}),e.jsx(N,{}),e.jsx(W,{children:e.jsxs(B,{templateColumns:"3fr 1fr",gap:10,children:[e.jsxs(D,{children:[e.jsxs(m,{mb:4,children:[e.jsx(P,{fontWeight:"bold",children:"TestCase Order"}),e.jsx(K,{name:"testCaseOrder",placeholder:"Nhập thứ tự TestCase",value:a.testCaseOrder,onChange:o})]}),e.jsxs(m,{mb:4,children:[e.jsx(P,{fontWeight:"bold",children:"Input"}),e.jsx(F,{name:"input",placeholder:"Nhập dữ liệu đầu vào",value:a.input,onChange:o,h:"50px"}),e.jsxs(T,{mt:2,bg:"gray.200",borderRadius:3,leftIcon:e.jsx(O,{}),as:"label",cursor:"pointer",children:["Import File",e.jsx(H,{type:"file",accept:".txt",onChange:t=>i(t,"input")})]})]}),e.jsxs(m,{mb:4,children:[e.jsx(P,{fontWeight:"bold",children:"Output"}),e.jsx(F,{name:"output",placeholder:"Nhập dữ liệu đầu ra",value:a.output,onChange:o}),e.jsxs(T,{mt:2,bg:"gray.200",borderRadius:3,leftIcon:e.jsx(O,{}),as:"label",cursor:"pointer",children:["Import File",e.jsx(H,{type:"file",accept:".txt",onChange:t=>i(t,"output")})]})]})]}),e.jsxs(D,{mt:5,children:[e.jsx(m,{mb:2,fontWeight:"bold",children:e.jsx(M,{isChecked:a.sampleTest===1,onChange:t=>h("sampleTest",t.target.checked),children:"Sample Test"})}),e.jsx(m,{fontWeight:"bold",children:e.jsx(M,{isChecked:a.preTest===1,onChange:t=>h("preTest",t.target.checked),children:"Pre Test"})})]})]})}),e.jsxs(Q,{children:[e.jsx(T,{colorScheme:"gray",mr:3,onClick:g,children:"Hủy"}),e.jsx(T,{colorScheme:"green",isLoading:x,loadingText:"Đang lưu...",onClick:y,children:"Thêm"})]})]})]})}const re=[{Header:"STT",accessor:"stt",Cell:({rowIndex:r})=>r+1},{Header:"Mã testcase",accessor:"testCaseID"},{Header:"Sample Test",accessor:"sampleTest"},{Header:"Input",accessor:"input"},{Header:"Output",accessor:"output"},{Header:"Hành động",accessor:"action",Cell:r=>e.jsx(Y,{...r,controller:"TestCase",deleteFunction:Z,idData:"testCaseID",deleteSuccessToast:{title:"Đã xóa!",description:"Testcase đã được xóa thành công."},deleteErrorToast:{title:"Xóa thất bại!",description:"Vui lòng thử lại sau."},fetchData:r.fetchData,isEdit:!0})}];function he(){_("Quản lý testcase");const{problemId:r}=R(),g=L(),{isOpen:j,onOpen:b,onClose:d}=se(),x=V(),[n,C]=c.useState("name"),[a,u]=c.useState(!0),[o,h]=c.useState(1),[i,y]=c.useState(10),t=["testcases",r,o,i,a,n],{data:s,isLoading:p}=U({queryKey:t,queryFn:()=>E({problemId:r,page:o,pageSize:i,ascending:a,sortField:n}),keepPreviousData:!0,staleTime:9999,retry:1,onError:()=>{g({title:"Lỗi khi tải dữ liệu",description:"Không thể tải dữ liệu. Vui lòng thử lại sau.",status:"error",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"})}});c.useEffect(()=>{s!=null&&s.totalPages&&o<s.totalPages&&x.prefetchQuery({queryKey:["testcases",r,o+1,i,a,n],queryFn:()=>E({problemId:r,page:o+1,pageSize:i,ascending:a,sortField:n})})},[s,r,o,i,a,n,x]);const f=l=>{n===l?u(!a):(C(l),u(!0)),h(1)},S=l=>{l>0&&l<=(s==null?void 0:s.totalPages)&&h(l)},I=l=>{const k=parseInt(l,10);k!==i&&(y(k),h(1))},v=()=>{x.invalidateQueries({queryKey:["testcases",r]})};return e.jsx($,{children:e.jsxs(G,{pt:{base:"130px",md:"80px",xl:"80px"},children:[e.jsx(J,{onAdd:b,onSearch:l=>console.log(l)}),e.jsx(ae,{isOpen:j,onClose:d,fetchData:v,problemID:r}),e.jsx(ee,{columnsData:re,tableData:(s==null?void 0:s.data)||[],loading:p,onSort:f,sortField:n,ascending:a,fetchData:v}),e.jsx(te,{currentPage:o,totalPages:(s==null?void 0:s.totalPages)||0,totalRows:(s==null?void 0:s.totalCount)||0,onPageChange:S,pageSize:i,onPageSizeChange:I})]})})}export{he as default};
