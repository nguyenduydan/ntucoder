import{_ as L,b as c,j as e,$ as q,a0 as w,a1 as z,a2 as N,a3 as A,a4 as B,a5 as K,a6 as D,a7 as m,a8 as P,g as Q,ae as F,m as T,af as H,ag as O,ah as M,ac as R,as as W,aj as V,ao as G,ap as U,B as X}from"./vendor-BGniOJC6.js";import{a as _,A as $,d as J,u as Y,g as E,S as Z,T as ee,C as te,P as se}from"./index-PLasXggS.js";import"./charts-vendor-CYURHQdq.js";import"./lodash-vendor-CS6reBND.js";import"./axios-vendor-xsH4HHeE.js";import"./moment-vendor-CTDujYFw.js";function ae({isOpen:r,onClose:g,fetchData:j,problemID:b}){const d=L(),[x,n]=c.useState(!1),C=c.useMemo(()=>({testCaseOrder:"",sampleTest:0,preTest:0,input:"",output:""}),[]),[a,u]=c.useState(C);c.useEffect(()=>{r||u(C)},[r,C]);const o=t=>{u({...a,[t.target.name]:t.target.value})},h=(t,s)=>{u(p=>({...p,[t]:s?1:0}))},i=(t,s)=>{const p=t.target.files[0];if(p){const f=new FileReader;f.onload=S=>{u(I=>({...I,[s]:S.target.result}))},f.readAsText(p)}},y=async()=>{if(!a.testCaseOrder||!a.output){d({title:"Lỗi",description:"Không được để trống.",status:"error",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"});return}if(isNaN(a.testCaseOrder)||parseInt(a.testCaseOrder)<=0){d({title:"Lỗi",description:"TestCase Order phải là số nguyên lớn hơn 0.",status:"error",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"});return}try{n(!0);const t=await _.post("/TestCase",{...a,problemID:b});if(t.status===200||t.status===201)d({title:"Thêm mới bài toán thành công!",status:"success",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"}),g(),j();else throw new Error("Có lỗi xảy ra khi thêm mới.")}catch(t){d({title:"Đã xảy ra lỗi.",description:t.message||"Có lỗi xảy ra khi tạo bài toán.",status:"error",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"})}finally{n(!1)}};return e.jsxs(q,{size:"2xl",isOpen:r,onClose:g,children:[e.jsx(w,{}),e.jsxs(z,{children:[e.jsx(N,{children:"Thêm TestCase mới"}),e.jsx(A,{}),e.jsx(B,{children:e.jsxs(K,{templateColumns:"3fr 1fr",gap:10,children:[e.jsxs(D,{children:[e.jsxs(m,{mb:4,children:[e.jsx(P,{fontWeight:"bold",children:"TestCase Order"}),e.jsx(Q,{name:"testCaseOrder",placeholder:"Nhập thứ tự TestCase",value:a.testCaseOrder,onChange:o})]}),e.jsxs(m,{mb:4,children:[e.jsx(P,{fontWeight:"bold",children:"Input"}),e.jsx(F,{name:"input",placeholder:"Nhập dữ liệu đầu vào",value:a.input,onChange:o,h:"50px"}),e.jsxs(T,{mt:2,bg:"gray.200",borderRadius:3,leftIcon:e.jsx(O,{}),as:"label",cursor:"pointer",children:["Import File",e.jsx(H,{type:"file",accept:".txt",onChange:t=>i(t,"input")})]})]}),e.jsxs(m,{mb:4,children:[e.jsx(P,{fontWeight:"bold",children:"Output"}),e.jsx(F,{name:"output",placeholder:"Nhập dữ liệu đầu ra",value:a.output,onChange:o}),e.jsxs(T,{mt:2,bg:"gray.200",borderRadius:3,leftIcon:e.jsx(O,{}),as:"label",cursor:"pointer",children:["Import File",e.jsx(H,{type:"file",accept:".txt",onChange:t=>i(t,"output")})]})]})]}),e.jsxs(D,{mt:5,children:[e.jsx(m,{mb:2,fontWeight:"bold",children:e.jsx(M,{isChecked:a.sampleTest===1,onChange:t=>h("sampleTest",t.target.checked),children:"Sample Test"})}),e.jsx(m,{fontWeight:"bold",children:e.jsx(M,{isChecked:a.preTest===1,onChange:t=>h("preTest",t.target.checked),children:"Pre Test"})})]})]})}),e.jsxs(R,{children:[e.jsx(T,{colorScheme:"gray",mr:3,onClick:g,children:"Hủy"}),e.jsx(T,{colorScheme:"green",isLoading:x,loadingText:"Đang lưu...",onClick:y,children:"Thêm"})]})]})]})}const re=[{Header:"STT",accessor:"stt",Cell:({rowIndex:r})=>r+1},{Header:"Mã testcase",accessor:"testCaseID"},{Header:"Sample Test",accessor:"sampleTest"},{Header:"Input",accessor:"input"},{Header:"Output",accessor:"output"},{Header:"Hành động",accessor:"action",Cell:r=>e.jsx($,{...r,controller:"TestCase",deleteFunction:J,idData:"testCaseID",deleteSuccessToast:{title:"Đã xóa!",description:"Testcase đã được xóa thành công."},deleteErrorToast:{title:"Xóa thất bại!",description:"Vui lòng thử lại sau."},fetchData:r.fetchData,isEdit:!0})}];function de(){Y("Quản lý testcase");const{problemId:r}=W(),g=L(),{isOpen:j,onOpen:b,onClose:d}=V(),x=G(),[n,C]=c.useState("name"),[a,u]=c.useState(!0),[o,h]=c.useState(1),[i,y]=c.useState(10),t=["testcases",r,o,i,a,n],{data:s,isLoading:p}=U({queryKey:t,queryFn:()=>E({problemId:r,page:o,pageSize:i,ascending:a,sortField:n}),keepPreviousData:!0,staleTime:9999,retry:1,onError:()=>{g({title:"Lỗi khi tải dữ liệu",description:"Không thể tải dữ liệu. Vui lòng thử lại sau.",status:"error",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"})}});c.useEffect(()=>{s!=null&&s.totalPages&&o<s.totalPages&&x.prefetchQuery({queryKey:["testcases",r,o+1,i,a,n],queryFn:()=>E({problemId:r,page:o+1,pageSize:i,ascending:a,sortField:n})})},[s,r,o,i,a,n,x]);const f=l=>{n===l?u(!a):(C(l),u(!0)),h(1)},S=l=>{l>0&&l<=(s==null?void 0:s.totalPages)&&h(l)},I=l=>{const k=parseInt(l,10);k!==i&&(y(k),h(1))},v=()=>{x.invalidateQueries({queryKey:["testcases",r]})};return e.jsx(Z,{children:e.jsxs(X,{pt:{base:"130px",md:"80px",xl:"80px"},children:[e.jsx(ee,{onAdd:b,onSearch:l=>console.log(l)}),e.jsx(ae,{isOpen:j,onClose:d,fetchData:v,problemID:r}),e.jsx(te,{columnsData:re,tableData:(s==null?void 0:s.data)||[],loading:p,onSort:f,sortField:n,ascending:a,fetchData:v}),e.jsx(se,{currentPage:o,totalPages:(s==null?void 0:s.totalPages)||0,totalRows:(s==null?void 0:s.totalCount)||0,onPageChange:S,pageSize:i,onPageSizeChange:I})]})})}export{de as default};
