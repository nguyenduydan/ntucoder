import{u as L,r as c,j as e,M as q,a as w,b as z,c as N,d as A,e as B,G as K,f as F,F as m,g as P,I as Q,T as D,B as T,V as H,H as M,C as O,h as R,i as W,A as V,k as G,l as U,m as X,n as J,o as Y,p as Z,q as E,S as _,s as $,t as ee,v as te,P as se}from"./index-DZ5M9zvS.js";function ae({isOpen:n,onClose:g,fetchData:j,problemID:b}){const d=L(),[x,o]=c.useState(!1),C=c.useMemo(()=>({testCaseOrder:"",sampleTest:0,preTest:0,input:"",output:""}),[]),[a,u]=c.useState(C);c.useEffect(()=>{n||u(C)},[n,C]);const r=t=>{u({...a,[t.target.name]:t.target.value})},h=(t,s)=>{u(p=>({...p,[t]:s?1:0}))},i=(t,s)=>{const p=t.target.files[0];if(p){const f=new FileReader;f.onload=S=>{u(I=>({...I,[s]:S.target.result}))},f.readAsText(p)}},y=async()=>{if(!a.testCaseOrder||!a.output){d({title:"Lỗi",description:"Không được để trống.",status:"error",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"});return}if(isNaN(a.testCaseOrder)||parseInt(a.testCaseOrder)<=0){d({title:"Lỗi",description:"TestCase Order phải là số nguyên lớn hơn 0.",status:"error",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"});return}try{o(!0);const t=await W.post("/TestCase",{...a,problemID:b});if(t.status===200||t.status===201)d({title:"Thêm mới bài toán thành công!",status:"success",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"}),g(),j();else throw new Error("Có lỗi xảy ra khi thêm mới.")}catch(t){d({title:"Đã xảy ra lỗi.",description:t.message||"Có lỗi xảy ra khi tạo bài toán.",status:"error",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"})}finally{o(!1)}};return e.jsxs(q,{size:"2xl",isOpen:n,onClose:g,children:[e.jsx(w,{}),e.jsxs(z,{children:[e.jsx(N,{children:"Thêm TestCase mới"}),e.jsx(A,{}),e.jsx(B,{children:e.jsxs(K,{templateColumns:"3fr 1fr",gap:10,children:[e.jsxs(F,{children:[e.jsxs(m,{mb:4,children:[e.jsx(P,{fontWeight:"bold",children:"TestCase Order"}),e.jsx(Q,{name:"testCaseOrder",placeholder:"Nhập thứ tự TestCase",value:a.testCaseOrder,onChange:r})]}),e.jsxs(m,{mb:4,children:[e.jsx(P,{fontWeight:"bold",children:"Input"}),e.jsx(D,{name:"input",placeholder:"Nhập dữ liệu đầu vào",value:a.input,onChange:r,h:"50px"}),e.jsxs(T,{mt:2,bg:"gray.200",borderRadius:3,leftIcon:e.jsx(M,{}),as:"label",cursor:"pointer",children:["Import File",e.jsx(H,{type:"file",accept:".txt",onChange:t=>i(t,"input")})]})]}),e.jsxs(m,{mb:4,children:[e.jsx(P,{fontWeight:"bold",children:"Output"}),e.jsx(D,{name:"output",placeholder:"Nhập dữ liệu đầu ra",value:a.output,onChange:r}),e.jsxs(T,{mt:2,bg:"gray.200",borderRadius:3,leftIcon:e.jsx(M,{}),as:"label",cursor:"pointer",children:["Import File",e.jsx(H,{type:"file",accept:".txt",onChange:t=>i(t,"output")})]})]})]}),e.jsxs(F,{mt:5,children:[e.jsx(m,{mb:2,fontWeight:"bold",children:e.jsx(O,{isChecked:a.sampleTest===1,onChange:t=>h("sampleTest",t.target.checked),children:"Sample Test"})}),e.jsx(m,{fontWeight:"bold",children:e.jsx(O,{isChecked:a.preTest===1,onChange:t=>h("preTest",t.target.checked),children:"Pre Test"})})]})]})}),e.jsxs(R,{children:[e.jsx(T,{colorScheme:"gray",mr:3,onClick:g,children:"Hủy"}),e.jsx(T,{colorScheme:"green",isLoading:x,loadingText:"Đang lưu...",onClick:y,children:"Thêm"})]})]})]})}const ne=[{Header:"STT",accessor:"stt",Cell:({rowIndex:n})=>n+1},{Header:"Mã testcase",accessor:"testCaseID"},{Header:"Sample Test",accessor:"sampleTest"},{Header:"Input",accessor:"input"},{Header:"Output",accessor:"output"},{Header:"Hành động",accessor:"action",Cell:n=>e.jsx(V,{...n,controller:"TestCase",deleteFunction:G,idData:"testCaseID",deleteSuccessToast:{title:"Đã xóa!",description:"Testcase đã được xóa thành công."},deleteErrorToast:{title:"Xóa thất bại!",description:"Vui lòng thử lại sau."},fetchData:n.fetchData,isEdit:!0})}];function oe(){U("Quản lý testcase");const{problemId:n}=X(),g=L(),{isOpen:j,onOpen:b,onClose:d}=J(),x=Y(),[o,C]=c.useState("name"),[a,u]=c.useState(!0),[r,h]=c.useState(1),[i,y]=c.useState(10),t=["testcases",n,r,i,a,o],{data:s,isLoading:p}=Z({queryKey:t,queryFn:()=>E({problemId:n,page:r,pageSize:i,ascending:a,sortField:o}),keepPreviousData:!0,staleTime:0,retry:1,onError:()=>{g({title:"Lỗi khi tải dữ liệu",description:"Không thể tải dữ liệu. Vui lòng thử lại sau.",status:"error",duration:2e3,isClosable:!0,position:"top",variant:"left-accent"})}});c.useEffect(()=>{s!=null&&s.totalPages&&r<s.totalPages&&x.prefetchQuery({queryKey:["testcases",n,r+1,i,a,o],queryFn:()=>E({problemId:n,page:r+1,pageSize:i,ascending:a,sortField:o})})},[s,n,r,i,a,o,x]);const f=l=>{o===l?u(!a):(C(l),u(!0)),h(1)},S=l=>{l>0&&l<=(s==null?void 0:s.totalPages)&&h(l)},I=l=>{const k=parseInt(l,10);k!==i&&(y(k),h(1))},v=()=>{x.invalidateQueries({queryKey:["testcases",n]})};return e.jsx(_,{children:e.jsxs($,{pt:{base:"130px",md:"80px",xl:"80px"},children:[e.jsx(ee,{onAdd:b,onSearch:l=>console.log(l)}),e.jsx(ae,{isOpen:j,onClose:d,fetchData:v,problemID:n}),e.jsx(te,{columnsData:ne,tableData:(s==null?void 0:s.data)||[],loading:p,onSort:f,sortField:o,ascending:a,fetchData:v}),e.jsx(se,{currentPage:r,totalPages:(s==null?void 0:s.totalPages)||0,totalRows:(s==null?void 0:s.totalCount)||0,onPageChange:S,pageSize:i,onPageSizeChange:I})]})})}export{oe as default};
