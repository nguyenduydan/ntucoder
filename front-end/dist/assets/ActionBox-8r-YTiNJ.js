import{r as s,U as v,j as e,b as i,ah as E,B as c,ar as M,e as z,c6 as H,o as I,D as A,at as W,W as $,au as F,Y as L,_ as P,a4 as X,i as y}from"./react-vendor-UrX0Iyen.js";import{a as D,m as O,L as Y}from"./index-DHxdizMM.js";import"./charts-vendor-DwxpLNbD.js";import"./vendor-DdjKqKjT.js";import"./lodash-vendor-CBiJWk4A.js";import"./axios-vendor-xsH4HHeE.js";import"./moment-vendor-CTDujYFw.js";const w=10,J=({coderID:n})=>{const[d,h]=s.useState([]),[r,x]=s.useState(!1),[f,p]=s.useState(1),[m,b]=s.useState(!0),g=s.useRef(null),j=v(),[l,a]=s.useState(null),C=s.useRef(),S=s.useCallback(async()=>{if(!(!n||!m)){x(!0);try{const o=(await D.get(`/Comments/by-coder?coderId=${n}&page=${f}&pageSize=${w}`)).data.data||[];h(u=>[...u,...o]),b(o.length===w)}catch(t){console.error("Error fetching comments:",t)}finally{x(!1)}}},[n,f,m]);s.useEffect(()=>{h([]),p(1),b(!0)},[n]),s.useEffect(()=>{S()},[S]);const R=()=>{const t=g.current;if(!t||r||!m)return;t.scrollTop+t.clientHeight>=t.scrollHeight-100&&p(u=>u+1)},T=t=>{a(t)},B=async()=>{if(l)try{await D.delete(`/comments/${l.commentID}`),h(t=>t.filter(o=>o.commentID!==l.commentID)),j({title:"Đã xóa bình luận",status:"success",duration:1500,isClosable:!0,position:"top",variant:"top-accent"})}catch(t){console.error("Delete comment error",t),j({title:"Không thể xóa bình luận",status:"error",duration:1500,isClosable:!0,position:"top"})}finally{a(null)}},k=s.useMemo(()=>d.length===0&&!r?e.jsx(i,{children:"Chưa có bình luận nào."}):e.jsxs(E,{spacing:4,align:"stretch",children:[d.map(t=>e.jsxs(c,{p:3,borderWidth:"1px",borderRadius:"md",boxShadow:"md",position:"relative",children:[e.jsxs(M,{spacing:3,mb:2,justifyContent:"space-between",children:[e.jsx(i,{fontSize:"xs",color:"gray.500",children:O(t.commentTime)}),e.jsx(z,{"aria-label":"Xóa bình luận",icon:e.jsx(H,{}),size:"xs",colorScheme:"red",onClick:()=>T(t),position:"absolute",top:2,right:2})]}),e.jsx(i,{children:Y(t.content,100)})]},t.commentID)),r&&e.jsx(I,{size:"sm",alignSelf:"center"})]}),[d,r]);return e.jsxs(e.Fragment,{children:[e.jsxs(c,{h:"100%",bg:"white",borderRadius:"lg",shadow:"md",display:"flex",flexDirection:"column",overflow:"hidden",px:5,py:4,children:[e.jsxs(c,{mb:2,children:[e.jsx(i,{fontSize:"xl",color:"blue.600",fontWeight:"bold",children:"Các bình luận"}),e.jsx(A,{mt:1,w:"60px",h:"3px",bg:"blue",borderRadius:"md"})]}),e.jsx(c,{ref:g,onScroll:R,overflowY:"auto",flex:1,pr:5,py:3,children:k})]}),e.jsx(W,{isOpen:!!l,leastDestructiveRef:C,onClose:()=>a(null),isCentered:!0,motionPreset:"slideInBottom",children:e.jsx($,{children:e.jsxs(F,{children:[e.jsx(L,{fontSize:"lg",fontWeight:"bold",children:"Xóa bình luận"}),e.jsx(P,{children:"Bạn chắc chắn muốn xóa bình luận này?"}),e.jsxs(X,{children:[e.jsx(y,{ref:C,onClick:()=>a(null),children:"Hủy"}),e.jsx(y,{colorScheme:"red",onClick:B,ml:3,children:"Xóa"})]})]})})})]})};export{J as default};
