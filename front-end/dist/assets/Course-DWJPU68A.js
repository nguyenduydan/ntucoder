import{at as D,j as t,r as s,R as T,s as h,D as d,z as E,au as u,av as O,a6 as z,a2 as K}from"./index-C3mpdEe2.js";import{C as L}from"./react-apexcharts.min-DvKORd24.js";class W extends D.Component{constructor(o){super(o),this.state={chartData:[],chartOptions:{}}}componentDidMount(){this.setState({chartData:this.props.chartData,chartOptions:this.props.chartOptions})}render(){return t.jsx(L,{options:this.state.chartOptions,series:this.state.chartData,type:"line",width:"100%",height:"100%"})}}const N=({refreshKey:p,onFinishRefresh:o,height:C})=>{const[r,S]=s.useState([]),[k,x]=s.useState(!1),[g,j]=s.useState(null),[l,b]=s.useState(10),[a,w]=s.useState("enrollCount"),[i,y]=s.useState(!1),m=s.useCallback(async()=>{x(!0),j(null);try{const e=await T({controller:"Course",page:1,pageSize:l,ascending:i,params:{sortField:a}});if(Array.isArray(e==null?void 0:e.data)){const c=e.data.map(n=>({...n,enrolls:n.enrollCount??0,title:n.courseName||"Không tên"}));S(c)}else throw new Error("Dữ liệu không hợp lệ.")}catch(e){j("Không thể tải danh sách khóa học."),console.error(e)}finally{x(!1),o&&o()}},[a,i,o,l]);s.useEffect(()=>{m()},[m,p]);const v=[{name:"Số lượt đăng ký",data:r.map(e=>({x:e.title||"Không tên",y:e.enrolls,date:a==="createdAt"||a==="updatedAt"?e[a]:e.updatedAt}))}],f={chart:{type:"line",toolbar:{show:!1}},stroke:{curve:"smooth",width:3},markers:{size:5},dataLabels:{enabled:!0},xaxis:{categories:r.map(e=>e.title||"Không tên"),labels:{show:!1},axisTicks:{show:!1},axisBorder:{show:!1}},tooltip:{enabled:!0,intersect:!1,custom:function({seriesIndex:e,dataPointIndex:c}){const n=v[e].data[c],A=K(n.date);return`
                    <div style="padding: 8px;">
                        <strong>${n.x}</strong><br />
                        Lượt đăng ký: <strong>${n.y}</strong><br />
                        Thời gian: <span>${A}</span>
                    </div>
                `}},colors:["#3182ce"]};return t.jsxs(h,{p:5,bg:"white",height:C||"auto",display:"flex",flexDirection:"column",minHeight:0,boxShadow:"md",children:[t.jsx(d,{fontSize:"xl",fontWeight:"bold",mb:4,children:"📈 Thống kê lượt đăng ký khóa học"}),t.jsxs(E,{mb:4,gap:4,children:[t.jsxs(u,{maxW:"200px",value:a,onChange:e=>w(e.target.value),children:[t.jsx("option",{value:"courseName",children:"Tên khóa học"}),t.jsx("option",{value:"enrollCount",children:"Số lượt đăng ký"}),t.jsx("option",{value:"createdAt",children:"Ngày tạo"}),t.jsx("option",{value:"updatedAt",children:"Theo ngày đăng ký"})]}),t.jsx(u,{maxW:"150px",value:i?"asc":"desc",onChange:e=>y(e.target.value==="asc"),children:a==="createdAt"||a==="updatedAt"?t.jsxs(t.Fragment,{children:[t.jsx("option",{value:"desc",children:"Mới nhất"}),t.jsx("option",{value:"asc",children:"Cũ nhất"})]}):a==="enrollCount"?t.jsxs(t.Fragment,{children:[t.jsx("option",{value:"desc",children:"Giảm dần"}),t.jsx("option",{value:"asc",children:"Tăng dần"})]}):t.jsxs(t.Fragment,{children:[t.jsx("option",{value:"desc",children:"Z-A"}),t.jsx("option",{value:"asc",children:"A-Z"})]})}),t.jsxs(u,{maxW:"150px",value:l,onChange:e=>b(e.target.value),children:[t.jsx("option",{value:"5",children:"5"}),t.jsx("option",{value:"10",children:"10"}),t.jsx("option",{value:"20",children:"20"}),t.jsx("option",{value:"50",children:"50"}),t.jsx("option",{value:"100",children:"100"})]})]}),t.jsx(h,{flex:"1",minHeight:0,overflow:"hidden",children:k?t.jsx(O,{height:"100%",children:t.jsx(z,{size:"xl"})}):g?t.jsx(d,{color:"red.500",children:g}):r.length>0?t.jsx(h,{w:"100%",h:"100%",minH:"0",children:t.jsx(W,{chartData:v,chartOptions:{...f,chart:{...f.chart,height:"100%"}}})}):t.jsx(d,{children:"Không có dữ liệu để hiển thị"})})]})};export{N as default};
