import{b as s,_ as k,j as e,T as i,aq as E,B as c,aC as H,f as M,cy as z,v as I,D as A,aG as $,a0 as F,aH as L,a2 as P,a4 as W,ac as X,m as y}from"./vendor-BGniOJC6.js";import{a as D,m as G,L as O}from"./index-PLasXggS.js";import"./charts-vendor-CYURHQdq.js";import"./lodash-vendor-CS6reBND.js";import"./axios-vendor-xsH4HHeE.js";import"./moment-vendor-CTDujYFw.js";const w=10,J=({coderID:o})=>{const[d,h]=s.useState([]),[r,x]=s.useState(!1),[f,p]=s.useState(1),[m,b]=s.useState(!0),g=s.useRef(null),j=k(),[a,l]=s.useState(null),C=s.useRef(),S=s.useCallback(async()=>{if(!(!o||!m)){x(!0);try{const n=(await D.get(`/Comments/by-coder?coderId=${o}&page=${f}&pageSize=${w}`)).data.data||[];h(u=>[...u,...n]),b(n.length===w)}catch(t){console.error("Error fetching comments:",t)}finally{x(!1)}}},[o,f,m]);s.useEffect(()=>{h([]),p(1),b(!0)},[o]),s.useEffect(()=>{S()},[S]);const T=()=>{const t=g.current;if(!t||r||!m)return;t.scrollTop+t.clientHeight>=t.scrollHeight-100&&p(u=>u+1)},R=t=>{l(t)},v=async()=>{if(a)try{await D.delete(`/comments/${a.commentID}`),h(t=>t.filter(n=>n.commentID!==a.commentID)),j({title:"Đã xóa bình luận",status:"success",duration:1500,isClosable:!0,position:"top",variant:"top-accent"})}catch(t){console.error("Delete comment error",t),j({title:"Không thể xóa bình luận",status:"error",duration:1500,isClosable:!0,position:"top"})}finally{l(null)}},B=s.useMemo(()=>d.length===0&&!r?e.jsx(i,{children:"Chưa có bình luận nào."}):e.jsxs(E,{spacing:4,align:"stretch",children:[d.map(t=>e.jsxs(c,{p:3,borderWidth:"1px",borderRadius:"md",boxShadow:"md",position:"relative",children:[e.jsxs(H,{spacing:3,mb:2,justifyContent:"space-between",children:[e.jsx(i,{fontSize:"xs",color:"gray.500",children:G(t.commentTime)}),e.jsx(M,{"aria-label":"Xóa bình luận",icon:e.jsx(z,{}),size:"xs",colorScheme:"red",onClick:()=>R(t),position:"absolute",top:2,right:2})]}),e.jsx(i,{children:O(t.content,100)})]},t.commentID)),r&&e.jsx(I,{size:"sm",alignSelf:"center"})]}),[d,r]);return e.jsxs(e.Fragment,{children:[e.jsxs(c,{h:"100%",bg:"white",borderRadius:"lg",shadow:"md",display:"flex",flexDirection:"column",overflow:"hidden",px:5,py:4,children:[e.jsxs(c,{mb:2,children:[e.jsx(i,{fontSize:"xl",color:"blue.600",fontWeight:"bold",children:"Các bình luận"}),e.jsx(A,{mt:1,w:"60px",h:"3px",bg:"blue",borderRadius:"md"})]}),e.jsx(c,{ref:g,onScroll:T,overflowY:"auto",flex:1,pr:5,py:3,children:B})]}),e.jsx($,{isOpen:!!a,leastDestructiveRef:C,onClose:()=>l(null),isCentered:!0,motionPreset:"slideInBottom",children:e.jsx(F,{children:e.jsxs(L,{children:[e.jsx(P,{fontSize:"lg",fontWeight:"bold",children:"Xóa bình luận"}),e.jsx(W,{children:"Bạn chắc chắn muốn xóa bình luận này?"}),e.jsxs(X,{children:[e.jsx(y,{ref:C,onClick:()=>l(null),children:"Hủy"}),e.jsx(y,{colorScheme:"red",onClick:v,ml:3,children:"Xóa"})]})]})})})]})};export{J as default};
