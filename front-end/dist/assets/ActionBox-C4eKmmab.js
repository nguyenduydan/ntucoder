import{r as s,u as v,i as y,j as e,D as c,y as E,s as i,a6 as M,ay as z,au as H,bF as F,a4 as I,$,ax as A,aF as P,a as W,aG as X,c as G,e as L,h as O,B as D}from"./index-DZ5M9zvS.js";const w=10,V=({coderID:o})=>{const[d,h]=s.useState([]),[r,x]=s.useState(!1),[f,p]=s.useState(1),[u,b]=s.useState(!0),g=s.useRef(null),j=v(),[a,l]=s.useState(null),C=s.useRef(),S=s.useCallback(async()=>{if(!(!o||!u)){x(!0);try{const n=(await y.get(`/Comments/by-coder?coderId=${o}&page=${f}&pageSize=${w}`)).data.data||[];h(m=>[...m,...n]),b(n.length===w)}catch(t){console.error("Error fetching comments:",t)}finally{x(!1)}}},[o,f,u]);s.useEffect(()=>{h([]),p(1),b(!0)},[o]),s.useEffect(()=>{S()},[S]);const R=()=>{const t=g.current;if(!t||r||!u)return;t.scrollTop+t.clientHeight>=t.scrollHeight-100&&p(m=>m+1)},T=t=>{l(t)},B=async()=>{if(a)try{await y.delete(`/comments/${a.commentID}`),h(t=>t.filter(n=>n.commentID!==a.commentID)),j({title:"Đã xóa bình luận",status:"success",duration:1500,isClosable:!0,position:"top",variant:"top-accent"})}catch(t){console.error("Delete comment error",t),j({title:"Không thể xóa bình luận",status:"error",duration:1500,isClosable:!0,position:"top"})}finally{l(null)}},k=s.useMemo(()=>d.length===0&&!r?e.jsx(c,{children:"Chưa có bình luận nào."}):e.jsxs(E,{spacing:4,align:"stretch",children:[d.map(t=>e.jsxs(i,{p:3,borderWidth:"1px",borderRadius:"md",boxShadow:"md",position:"relative",children:[e.jsxs(M,{spacing:3,mb:2,justifyContent:"space-between",children:[e.jsx(c,{fontSize:"xs",color:"gray.500",children:z(t.commentTime)}),e.jsx(H,{"aria-label":"Xóa bình luận",icon:e.jsx(F,{}),size:"xs",colorScheme:"red",onClick:()=>T(t),position:"absolute",top:2,right:2})]}),e.jsx(c,{children:I(t.content,100)})]},t.commentID)),r&&e.jsx($,{size:"sm",alignSelf:"center"})]}),[d,r]);return e.jsxs(e.Fragment,{children:[e.jsxs(i,{h:"100%",bg:"white",borderRadius:"lg",shadow:"md",display:"flex",flexDirection:"column",overflow:"hidden",px:5,py:4,children:[e.jsxs(i,{mb:2,children:[e.jsx(c,{fontSize:"xl",color:"blue.600",fontWeight:"bold",children:"Các bình luận"}),e.jsx(A,{mt:1,w:"60px",h:"3px",bg:"blue",borderRadius:"md"})]}),e.jsx(i,{ref:g,onScroll:R,overflowY:"auto",flex:1,pr:5,py:3,children:k})]}),e.jsx(P,{isOpen:!!a,leastDestructiveRef:C,onClose:()=>l(null),isCentered:!0,motionPreset:"slideInBottom",children:e.jsx(W,{children:e.jsxs(X,{children:[e.jsx(G,{fontSize:"lg",fontWeight:"bold",children:"Xóa bình luận"}),e.jsx(L,{children:"Bạn chắc chắn muốn xóa bình luận này?"}),e.jsxs(O,{children:[e.jsx(D,{ref:C,onClick:()=>l(null),children:"Hủy"}),e.jsx(D,{colorScheme:"red",onClick:B,ml:3,children:"Xóa"})]})]})})})]})};export{V as default};
