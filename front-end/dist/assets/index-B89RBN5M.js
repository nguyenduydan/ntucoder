import{b as n,j as e,B as y,cu as Q,K as U,O as Y,P as z,Q as v,R as J,U as g,ad as P,F as u,cv as $,c1 as N,aE as _,aB as Z,T as C,an as D,aq as ee,cw as te,_ as se,C as ae,H as oe}from"./vendor-BGniOJC6.js";import{b as ne,i as L,u as re,r as ie,v as le,P as ce,a as H}from"./index-PLasXggS.js";import"./charts-vendor-CYURHQdq.js";import"./lodash-vendor-CS6reBND.js";import"./axios-vendor-xsH4HHeE.js";import"./moment-vendor-CTDujYFw.js";const I=7*24*60*60*1e3,de=({coders:r,loading:s,currentPage:p=1,pageSize:b=10,onReset:i})=>{const{coder:c}=ne(),j=(c==null?void 0:c.coderID)||"",[S,x]=n.useState(0);n.useEffect(()=>{let t=localStorage.getItem("rankingResetTime");t?t=parseInt(t,10):(t=Date.now()+I,localStorage.setItem("rankingResetTime",t));const a=()=>{const l=Date.now(),f=t-l;if(f<=0){const w=l+I;localStorage.setItem("rankingResetTime",w),x(I),i&&typeof i=="function"&&i()}else x(f)};a();const d=setInterval(a,1e3);return()=>clearInterval(d)},[i]);const m=t=>{const a=Math.floor(t/1e3),d=Math.floor(a/(24*3600)),l=Math.floor(a%(24*3600)/3600),f=Math.floor(a%3600/60),w=a%60;return`${d} ngày ${l.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`};return e.jsxs(y,{minH:"40vh",overflowX:"auto",children:[e.jsxs(y,{mb:4,p:2,bg:"blue.50",borderRadius:"md",textAlign:"center",fontWeight:"semibold",color:"blue.700",children:["Reset bảng xếp hạng trong: ",m(S)]}),e.jsx(Q,{overflowX:"auto",children:e.jsxs(U,{size:"sm",colorScheme:"blue",minW:"320px",children:[e.jsx(Y,{bg:"gray.100",position:"sticky",top:0,zIndex:1,children:e.jsxs(z,{children:[e.jsx(v,{w:"20px",py:[2,3],fontSize:["xs","sm"],children:"#"}),e.jsx(v,{ps:[2,5],fontSize:["sm","md"],children:"Tên người dùng"}),e.jsx(v,{ps:[2,5],fontSize:["sm","md"],children:"Điểm"})]})}),e.jsx(J,{children:s?Array.from({length:5}).map((t,a)=>e.jsxs(z,{children:[e.jsx(g,{py:[2,4],children:e.jsx(P,{height:"20px"})}),e.jsx(g,{py:[2,4],children:e.jsxs(u,{align:"center",gap:3,children:[e.jsx($,{size:["6","8"]}),e.jsx(N,{noOfLines:1,width:"120px"})]})}),e.jsx(g,{py:[2,4],children:e.jsx(P,{height:"20px",width:"60px"})})]},`skeleton-${a}`)):Array.isArray(r)&&r.length>0?r.map((t,a)=>e.jsxs(z,{bg:t.coderID===j?"blue.300":"white",children:[e.jsx(g,{py:[2,4],fontWeight:"bold",fontSize:["xs","sm"],children:(p-1)*b+a+1}),e.jsx(g,{py:[2,4],children:e.jsx(_,{to:`/profile/${t.coderID}`,children:e.jsxs(u,{alignItems:"center",gap:3,_hover:{color:"blue.600",transform:"scale(1.02)"},transition:"all .2s ease-in-out",children:[e.jsx(Z,{name:t.coderName||"Coder",src:t.avatar,size:["xs","sm"],loading:"lazy"}),e.jsx(C,{fontWeight:"bold",fontSize:["sm","md"],children:t.coderName})]})})}),e.jsx(g,{py:[2,4],children:e.jsxs(D,{fontSize:["xs","sm"],colorScheme:"green",children:[t.totalPoint," điểm"]})})]},t.coderID)):e.jsx(z,{children:e.jsx(g,{colSpan:3,py:[6,8],textAlign:"center",fontSize:["sm","md"],children:e.jsx(C,{fontStyle:"italic",color:"gray.500",children:"Không có dữ liệu để hiển thị."})})})})]})})]})},R=({coder:r,rank:s,gradient:p,crown:b=!1,isLoading:i=!1})=>{const c=!!r,j=s===1?{base:"90vw",sm:"350px",md:"400px"}:{base:"70vw",sm:"300px",md:"300px"},S=s===1?{base:4,sm:5,md:6}:{base:4,sm:4,md:4},x=s===1?{base:"lg",sm:"lg",md:"2xl"}:{base:"lg",sm:"lg",md:"xl"},m=s===1?{base:3,sm:4}:{base:3,sm:4},t=s===1?{base:3,sm:4}:{base:3,sm:4},a=s===1?{base:"-24px",sm:"-28px",md:"-32px"}:{base:"-24px",sm:"-28px",md:"-32px"},d=s===1?{base:"lg",sm:"md"}:{base:"md",sm:"sm"},l=s===1?{base:"md",sm:"lg"}:{base:"sm",sm:"sm"};return e.jsxs(ee,{bgGradient:p,borderRadius:"md",p:S,shadow:s===1?"2xl":"md",width:j,minH:s===1?"auto":"100px",_hover:{shadow:s===1?"4xl":"lg",transform:s===1?"scale(1.07)":"scale(1.05)",...s===1&&{boxShadow:"0 0 20px 4px rgba(255, 223, 71, 0.9)"}},transition:"all 0.3s ease",position:"relative",children:[b&&!i&&e.jsx(y,{position:"absolute",top:a,color:"yellow.400",fontSize:{base:"4xl",sm:"5xl",md:"6xl"},children:e.jsx(te,{})}),e.jsxs(D,{colorScheme:"yellow",position:"absolute",top:m,right:t,fontSize:l,px:s===1?{base:2,sm:3}:{base:2,sm:3},borderRadius:"full",children:["#",s]}),i?e.jsxs(e.Fragment,{children:[e.jsx($,{size:"100px",mb:2}),e.jsx(N,{noOfLines:1,width:"80px",mb:2})]}):c?e.jsx(_,{to:`/profile/${r.coderID}`,children:e.jsxs(u,{flexDirection:"column",align:"center",mb:2,children:[e.jsx(L,{size:x,name:r.coderName,src:r.avatar,mb:2}),e.jsx(C,{fontWeight:"bold",fontSize:d,textAlign:"center",children:r.coderName})]})}):e.jsxs(u,{flexDirection:"column",align:"center",mb:2,children:[e.jsx(L,{size:x,name:"Chưa có người dùng",mb:2}),e.jsx(C,{fontWeight:"bold",fontSize:d,children:"Chưa có người dùng"})]}),i?e.jsx(P,{height:"30px",width:"60px",borderRadius:"full"}):e.jsx(D,{fontSize:l,colorScheme:"teal",fontWeight:"semibold",children:c?`${r.totalPoint} điểm`:"0 điểm"})]})},ue=()=>{re("Ranking");const r=se(),[s,p]=n.useState(!1),[b,i]=n.useState(!1),[c,j]=n.useState([]),[S,x]=n.useState([]),[m,t]=n.useState(1),[a,d]=n.useState(10),[l,f]=n.useState(0),[w,B]=n.useState(0),[A,M]=n.useState(""),F=ie(A,500),W=async()=>{p(!0);try{const o=await H.get("/Coder/top-hightest");o.status===200&&j(o.data)}catch(o){console.error("Failed to fetch top 3 coders:",o),r({title:"Failed to fetch data",description:o.message,status:"error",duration:2e3,isClosable:!0,variant:"top-accent",position:"top"})}finally{p(!1)}},T=async(o=1,K=10,V="")=>{i(!0);try{const h=await H.get("/Coder/list-ranking",{params:{page:o,pageSize:K,q:V}});h.status===200&&(x(h.data.data),f(h.data.totalPages),B(h.data.totalCount))}catch(h){console.error("Failed to fetch top 3 coders:",h),r({title:"Failed to fetch data",description:h.message,status:"error",duration:2e3,isClosable:!0,variant:"top-accent",position:"top"})}finally{i(!1)}};n.useEffect(()=>{W()},[]),n.useEffect(()=>{T(m,a,F)},[F,m,a]);const[k,O,X]=c,q=o=>{t(o),T(o,a)},G=o=>{d(o),t(1),T(1,o)},E=()=>{W(),T(1,a)};return n.useEffect(()=>{E()},[]),e.jsxs(ae,{maxW:["100vw","container.md","container.xl"],minH:"90vh",p:[6,0],bg:"gray.200",overflowX:"hidden",children:[e.jsxs(y,{bgGradient:"linear(to-r, purple.500, blue.500)",p:[4,6],borderRadius:"md",mb:8,boxShadow:"md",children:[e.jsx(oe,{mb:8,textAlign:"center",fontSize:["3xl","4xl","5xl"],fontWeight:"extrabold",letterSpacing:"wide",textTransform:"uppercase",color:"green.500",textShadow:"2px 4px 3px rgb(22, 56, 9), 0 1px 20px #fff",children:"Ranking"}),e.jsxs(u,{justify:"center",align:"flex-end",gap:[4,6,10],flexDirection:["column","row"],children:[e.jsx(R,{coder:O,rank:2,gradient:"linear(to-br, green.800, green.500, green.300)",isLoading:s,size:["md","lg","xl"]}),e.jsx(R,{coder:k,rank:1,gradient:"linear(to-br, yellow.800, yellow.500, yellow.300)",crown:!0,size:["lg","2xl","3xl"],isLoading:s,mt:[4,0]}),e.jsx(R,{coder:X,rank:3,gradient:"linear(to-br, blue.800, blue.500, blue.300)",isLoading:s,size:["md","lg","xl"]})]})]}),e.jsxs(y,{bg:"white",p:[4,6],borderRadius:"md",shadow:"md",mb:8,minH:"50vh",children:[e.jsx(u,{justify:"flex-start",mb:8,flexDirection:["column","row"],alignItems:["stretch","center"],gap:[4,0],children:e.jsx(le,{type:"text",placeholder:"Tìm người dùng...",value:A,onChange:o=>{M(o.target.value),t(1)},borderRadius:"full",boxShadow:"md",borderWidth:"1px",w:["100%","300px"]})}),e.jsx(de,{coders:S,loading:b,onReset:E}),e.jsx(ce,{currentPage:m,totalPages:l,totalRows:w,onPageChange:q,pageSize:a,onPageSizeChange:G,mt:4})]})]})};export{ue as default};
