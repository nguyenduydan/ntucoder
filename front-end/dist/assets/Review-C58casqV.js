import{r as i,j as e,a6 as l,aA as $,aQ as E,E as _,u as B,i as f,s as x,Q as m,D as r,ar as w,y as L,bw as F,T as H,x as N,B as S,a_ as y,$ as Q,ab as V,a7 as W,Y as G,b6 as P}from"./index-Du5abbo3.js";function X({value:h,onChange:u}){const[n,c]=i.useState(0);return e.jsx(l,{spacing:.5,children:[1,2,3,4,5].map(t=>e.jsx($,{icon:e.jsx(E,{fontSize:"24px"}),variant:"ghost",color:t<=(n||h)?"yellow.400":"gray.300",onMouseEnter:()=>c(t),onMouseLeave:()=>c(0),onClick:()=>u(t),"aria-label":`Chọn ${t} sao`,size:"lg",boxSize:"40px",_hover:{transform:"scale(1.2)"}},t))})}const q=({courseId:h})=>{const{isAuthenticated:u}=_(),[n,c]=i.useState({rating:5,content:""}),[t,k]=i.useState([]),[z,C]=i.useState(!0),[R,D]=i.useState([0,0,0,0,0]),g=B(),[p,T]=i.useState(!1),b=p?t:t.slice(0,5),A=()=>{T(s=>!s)},j=i.useCallback(async()=>{try{const a=(await f.get(`/Review?courseId=${h}`)).data||[];k(a);const o=[0,0,0,0,0];a.forEach(M=>o[M.rating-1]++),D(o.reverse())}catch(s){g({title:"Lỗi",description:s.message,status:"error"})}finally{C(!1)}},[h,g]),I=async()=>{try{const s=await f.post(`/Review?courseId=${h}`,n);(s.status===200||s.status===201)&&(g({title:"Thành công",description:"Đánh giá đã được gửi!",status:"success",variant:"top-accent",duration:2e3,position:"top",isClosable:!0}),c({...n,content:"",rating:5})),j()}catch(s){g({title:"Thất bại",description:s.message,status:"error",variant:"top-accent",duration:2e3,position:"top",isClosable:!0})}};i.useEffect(()=>{j()},[j]);const d=t.length,v=d>0?(t.reduce((s,a)=>s+a.rating,0)/d).toFixed(1):0;return e.jsxs(x,{mx:"auto",p:4,children:[e.jsx(m,{size:"lg",mb:4,children:"Đánh giá khóa học"}),e.jsxs(l,{spacing:6,align:"start",mb:6,children:[e.jsxs(x,{minW:"200px",children:[e.jsx(r,{fontSize:"5xl",children:v}),e.jsx(l,{children:[...Array(5)].map((s,a)=>e.jsx(w,{boxSize:7,color:a<Math.round(v)?"yellow.400":"gray.300"},a))}),e.jsxs(r,{color:"gray.500",mt:3,children:["(",d," đánh giá)"]})]}),e.jsx(L,{align:"start",flex:1,children:[5,4,3,2,1].map((s,a)=>{const o=d?Math.round(R[a]/d*100):0;return e.jsxs(l,{w:"100%",children:[e.jsxs(r,{w:"30px",flex:"0.1",children:[s," sao"]}),e.jsx(F,{value:o,flex:"1",size:"sm",colorScheme:"yellow",bg:"gray.200",rounded:"md",sx:{"& > div":{backgroundColor:"yellow.400"}}}),e.jsxs(r,{w:"40px",textAlign:"right",color:"gray.400",children:[o,"%"]})]},s)})})]}),u&&e.jsxs(x,{mb:8,children:[e.jsx(m,{size:"md",mb:3,children:"Viết đánh giá"}),e.jsx(H,{placeholder:"Nội dung đánh giá của bạn...",value:n.content,onChange:s=>c({...n,content:s.target.value}),mb:3,resize:"none",h:"140px"}),e.jsxs(N,{justify:"flex-end",children:[e.jsx(X,{value:n.rating,onChange:s=>c({...n,rating:s})}),e.jsx(S,{colorScheme:"blue",ml:3,onClick:I,isDisabled:n.content.length===0,children:"Gửi đánh giá"})]})]}),e.jsx(y,{mb:6}),e.jsx(m,{size:"md",mb:4,children:"Đánh giá của người học"}),z?e.jsx(Q,{}):b.length===0?e.jsx(r,{children:"Chưa có đánh giá nào."}):b.map(s=>e.jsxs(x,{mb:2,p:3,borderRadius:"md",children:[e.jsxs(l,{mb:1,children:[e.jsx(V,{coderID:s.coderID,size:"sm"}),e.jsxs(x,{children:[e.jsx(W,{to:`/profile/${s.coderID}`,children:e.jsx(r,{_hover:{color:"blue"},fontWeight:"bold",children:(s.coderName||"Ẩn danh").replace(/(.{3}).*(@.*)/,"$1******$2")})}),e.jsxs(l,{spacing:1,children:[[...Array(5)].map((a,o)=>e.jsx(G,{as:w,color:o<s.rating?"yellow.400":"gray.300"},o)),e.jsx(r,{fontSize:"xs",color:"gray.500",children:P(s.createdAt)})]})]})]}),e.jsx(r,{mt:2,children:s.content}),e.jsx(y,{mt:2})]},s.reviewID)),t.length>5&&e.jsx(S,{mt:4,variant:"outline",colorScheme:"black",_hover:{bg:"black",color:"white"},onClick:A,children:p?"Thu gọn":"Xem thêm"})]})};export{q as default};
