import{b as n,aO as se,aj as q,_ as X,j as e,$ as ne,a0 as G,a1 as ae,a2 as _,a7 as L,a8 as N,g as ie,F as c,aB as oe,T as F,a3 as le,a4 as J,B as o,aJ as re,ac as Q,aN as ce,m as g,aG as de,aH as he,ai as ge,C as me,H as K,v as ue,an as xe,w as pe,cx as fe,V as be,aE as je}from"./vendor-BGniOJC6.js";import{I as Ce,w as ve,x as Se,y as we,u as ye,b as Be,S as Te,p as ze,m as He,j as ke,t as Ie,s as Le,L as Ne,P as Fe,a as U}from"./index-PLasXggS.js";import{L as Pe}from"./ListBlogs-1aDKiTu4.js";import{B as De}from"./BlogTopViews-BDuwb0OA.js";import"./charts-vendor-CYURHQdq.js";import"./lodash-vendor-CS6reBND.js";import"./axios-vendor-xsH4HHeE.js";import"./moment-vendor-CTDujYFw.js";import"./InfoBlog-CsMpZi6p.js";const We=({isOpen:P,onClose:p,onSuccess:D,authorName:W,authorAvatar:f})=>{const[d,b]=n.useState(""),[i,B]=n.useState(""),[t,j]=n.useState(!1),[T,z]=n.useState(null),l=se.useRef(),[A,m]=n.useState(!1),{isOpen:H,onOpen:C,onClose:v}=q(),h=X(),R=d.trim()||i.trim()!==""||t,S=()=>{b(""),B(""),j(!1)},V=async()=>{if(!d.trim()){h({title:"Vui lòng nhập tiêu đề.",status:"warning",duration:2e3,isClosable:!0});return}if(!i||i==="<p><br></p>"){h({title:"Vui lòng nhập nội dung.",status:"warning",duration:2e3,isClosable:!0});return}const a=new FormData;a.append("title",d),a.append("content",i),a.append("published","1"),a.append("pinHome",t?"1":"0"),T&&a.append("imageFile",T);try{m(!0),await we({controller:"Blog",data:a}),h({title:"Đăng bài thành công!",status:"success",duration:2e3,position:"top",variant:"left-accent",isClosable:!0}),S(),D(),p()}catch(I){h({title:"Lỗi khi đăng bài.",description:I.message||"Không thể gửi bài",status:"error",duration:3e3,position:"top",variant:"left-accent",isClosable:!0})}finally{m(!1)}},k=()=>{R?C():(S(),p())},M=()=>{S(),v(),p()};return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{isOpen:P,onClose:k,size:"6xl",isCentered:!0,scrollBehavior:"inside",motionPreset:"slideInBottom",children:[e.jsx(G,{}),e.jsxs(ae,{children:[e.jsxs(_,{children:[e.jsxs(L,{children:[e.jsx(N,{textAlign:"center",fontWeight:"bold",fontSize:"2xl",children:"Đăng bài viết mới"}),e.jsx(ie,{placeholder:"Nhập tiêu đề bài viết",value:d,onChange:a=>b(a.target.value),autoFocus:!0})]}),e.jsxs(c,{align:"center",mt:4,bgGradient:"linear(to-r, blue.500, blue.400)",p:2,borderRadius:"lg",children:[e.jsx(oe,{src:f,mr:3}),e.jsx(F,{color:"white",fontWeight:"bold",children:W})]})]}),e.jsx(le,{}),e.jsx(J,{children:e.jsxs(o,{mb:3,children:[e.jsxs(L,{mb:6,children:[e.jsx(N,{textAlign:"center",fontWeight:"bold",children:"Ảnh đại diện"}),e.jsx(Ce,{label:"chọn ảnh đại diện",previewWidth:"80vh",previewHeight:"40vh",onImageChange:a=>z(a)})]}),e.jsxs(L,{children:[e.jsx(N,{fontWeight:"bold",children:"Nội dung"}),e.jsx(re,{value:i,onChange:B,modules:Se,formats:ve,theme:"snow",placeholder:"Chia sẻ cảm nghĩ của bạn hoặc thêm hình ảnh vào nội dung..."})]})]})}),e.jsxs(Q,{justifyContent:"space-between",children:[e.jsx(c,{gap:4,flex:1,children:e.jsxs(L,{display:"flex",alignItems:"center",children:[e.jsx(N,{htmlFor:"pinHome",mb:"0",fontWeight:"bold",children:"Ghim ở trang chủ"}),e.jsx(ce,{id:"pinHome",isChecked:t,onChange:a=>j(a.target.checked)})]})}),e.jsxs(o,{children:[e.jsx(g,{variant:"ghost",mr:3,onClick:k,children:"Hủy"}),e.jsx(g,{colorScheme:"blue",onClick:V,isLoading:A,loadingText:"Đang đăng bài...",children:"Đăng bài"})]})]})]})]}),e.jsx(de,{isOpen:H,leastDestructiveRef:l,onClose:v,isCentered:!0,children:e.jsx(G,{children:e.jsxs(he,{children:[e.jsx(_,{fontSize:"lg",fontWeight:"bold",children:"Cảnh báo"}),e.jsx(J,{children:"Bạn có chắc chắn muốn bỏ tạo bài mới?"}),e.jsxs(Q,{children:[e.jsx(g,{ref:l,onClick:v,children:"Tiếp tục chỉnh sửa"}),e.jsx(g,{colorScheme:"red",onClick:M,ml:3,children:"Hủy"})]})]})})})]})},Je=()=>{ye("Bài viết");const P=ge(),{isOpen:p,onOpen:D,onClose:W}=q(),[f,d]=n.useState(!1),b=X(),{coder:i,isAuthenticated:B}=Be(),[t,j]=n.useState(null),[T,z]=n.useState([]),[l,A]=n.useState([]),[m,H]=n.useState(1),[C,v]=n.useState(10),[h,R]=n.useState(0),[S,V]=n.useState(0),k=async(s=1,u=10,w=[])=>{try{const r=await U.get("/Blog/Latest",{params:{page:s,pageSize:u,excludedIds:w.join(",")}});if(r.status===200)return r.data}catch(r){throw r}},M=async(s=3)=>{try{return(await U.get(`/Blog/TopViewed?count=${s}`)).data}catch(u){throw u}},a=async()=>{try{const s=await M();A(s||[])}catch(s){b({title:"Lỗi khi tải bài viết phổ biến",description:s.message||"Không thể tải dữ liệu",status:"error",duration:3e3,isClosable:!0,variant:"top-accent",position:"top"})}},I=async(s,u)=>{d(!0);try{const w=l.map(E=>E.blogID),r=await k(s,u,w),O=r.data||[];if(R(r.totalPages),V(r.totalCount),O.length>0){j(O[0]);const E=O.slice(1),ee=(te=>{const x=[...te];for(let y=x.length-1;y>0;y--){const $=Math.floor(Math.random()*(y+1));[x[y],x[$]]=[x[$],x[y]]}return x})(E);z(ee)}else j(null),z([])}catch(w){b({title:"Lỗi khi tải bài viết mới nhất",description:w.message||"Không thể tải dữ liệu",status:"error",duration:3e3,isClosable:!0,variant:"top-accent",position:"top"})}finally{d(!1)}};n.useEffect(()=>{l.length===0&&a()},[]),n.useEffect(()=>{l.length>0&&I(m,C)},[m,C,l]);const Y=s=>{s>=1&&s<=h&&H(s)},Z=s=>{v(s),H(1)};return e.jsx(Te,{children:e.jsx(o,{bg:"gray.200",children:e.jsxs(me,{maxW:"8xl",py:8,minH:"86vh",children:[B&&e.jsx(c,{align:"center",justify:"end",children:e.jsx(g,{colorScheme:"blue",onClick:D,children:"Đăng bài mới"})}),e.jsx(We,{isOpen:p,onClose:W,onSuccess:I,authorName:(i==null?void 0:i.coderName)||"Nguyễn Thiết Duy Đan",authorAvatar:(i==null?void 0:i.avatar)||"https://i.pravatar.cc/150?img=10"}),e.jsxs(c,{gap:8,mb:8,flexWrap:{base:"wrap",md:"nowrap"},children:[e.jsxs(o,{flex:"0.8",minW:{base:"100%",md:"0"},mb:{base:6,md:0},children:[e.jsx(K,{size:{base:"sm",md:"md"},fontWeight:"bold",mb:4,textTransform:"uppercase",children:"Bài viết mới nhất"}),e.jsx(o,{bg:"white",p:6,rounded:"md",shadow:"md",children:f?e.jsx(c,{justify:"center",align:"center",height:"70vh",children:e.jsx(ue,{})}):t?e.jsxs(o,{minH:"80vh",children:[e.jsxs(c,{align:"center",mb:5,children:[e.jsx(ze,{size:"md",name:t.coderName||t.CoderName||t.author||"Người dùng",src:t.avatarCoder||"",mr:2}),e.jsxs(o,{children:[e.jsx(g,{variant:"link",colorScheme:"black",onClick:()=>P(`/profile/${t.coderID}`),children:e.jsx(F,{fontWeight:"bold",fontSize:"lg",children:t.coderName||t.CoderName||t.author||"Người dùng"})}),e.jsxs(c,{align:"center",gap:3,mt:1,children:[e.jsx(F,{fontSize:"sm",color:"gray.500",children:He(t.blogDate||t.BlogDate)}),e.jsxs(xe,{colorScheme:"blue",display:"flex",alignItems:"center",fontSize:"0.75rem",px:2,children:[e.jsx(pe,{as:fe,mr:2}),ke(t.viewCount||t.ViewCount||0)," lượt xem"]})]})]})]}),e.jsx(o,{children:e.jsx(be,{size:"md",name:t.title||t.Title||"Không có ảnh",src:t.imageBlogUrl||"./avatarSimmmple.png",w:"100%",maxH:"340px",objectFit:"cover",alt:t.title||t.Title||"Không có ảnh",fallbackSrc:"./avatarSimmmple.png",borderRadius:"md",mb:4,loading:"lazy"})}),e.jsxs(c,{direction:"column",children:[e.jsx(je,{to:`/blogs/${Ie(t.title||t.Title)}-${t.blogID}`,children:e.jsx(g,{variant:"link",colorScheme:"black",fontSize:{base:"md",md:"lg",xl:"xl"},fontWeight:"bold",mb:{base:2,md:3},whiteSpace:"normal",textAlign:"left",px:0,children:t.title||t.Title||"Không có tiêu đề"})}),e.jsx(o,{whiteSpace:"pre-wrap",fontSize:{base:"sm",md:"md"},mb:{base:3,md:4},wordBreak:"break-word",dangerouslySetInnerHTML:{__html:Le(Ne(t.content||t.Content||"",200))}})]})]}):e.jsx(o,{minH:"70vh",display:"flex",justifyContent:"center",alignItems:"center",children:e.jsx(F,{children:"Chưa có bài viết nào."})})})]}),e.jsxs(o,{flex:"1",maxHeight:"max-content",display:"flex",flexDirection:"column",children:[e.jsx(K,{size:{base:"sm",md:"md"},mb:4,textTransform:"uppercase",children:"Các bài viết nổi bật"}),e.jsx(De,{blogs:l,loading:f})]})]}),e.jsx(K,{fontSize:"xl",fontWeight:"bold",mb:4,textTransform:"uppercase",children:"Các bài viết trước đó"}),e.jsx(o,{minH:"40vh",children:e.jsx(Pe,{blogs:T,loading:f})}),e.jsx(Fe,{currentPage:m,totalPages:h,totalRows:S,onPageChange:Y,pageSize:C,onPageSizeChange:Z})]})})})};export{Je as default};
