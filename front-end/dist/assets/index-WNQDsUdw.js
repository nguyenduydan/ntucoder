import{r as n,aM as se,U as X,j as e,V as ne,W as _,X as ae,Y as G,a1 as L,a2 as N,f as ie,F as c,aq as oe,b as F,Z as le,_ as U,B as o,aw as re,a4 as q,aA as ce,i as g,at as de,au as he,aa as ge,C as me,H as E,o as ue,ae as xe,p as pe,c5 as fe,N as be,as as je}from"./react-vendor-jMCSND2O.js";import{I as Ce,w as ve,x as Se,y as we,u as ye,b as Be,S as Te,p as ze,m as ke,j as He,t as Ie,s as Le,L as Ne,P as Fe,a as Q}from"./index-b-BR7AAp.js";import{aA as Y}from"./vendor-BYm5b_XE.js";import{L as Pe}from"./ListBlogs-Nr1SQwGF.js";import{B as We}from"./BlogTopViews-DHJ6l-UH.js";import"./charts-vendor-DwxpLNbD.js";import"./lodash-vendor-CBiJWk4A.js";import"./InfoBlog-4TxqjEPd.js";const Ae=({isOpen:P,onClose:p,onSuccess:W,authorName:A,authorAvatar:f})=>{const[d,b]=n.useState(""),[i,B]=n.useState(""),[t,j]=n.useState(!1),[T,z]=n.useState(null),l=se.useRef(),[D,m]=n.useState(!1),{isOpen:k,onOpen:C,onClose:v}=Y(),h=X(),M=d.trim()||i.trim()!==""||t,S=()=>{b(""),B(""),j(!1)},R=async()=>{if(!d.trim()){h({title:"Vui lòng nhập tiêu đề.",status:"warning",duration:2e3,isClosable:!0});return}if(!i||i==="<p><br></p>"){h({title:"Vui lòng nhập nội dung.",status:"warning",duration:2e3,isClosable:!0});return}const a=new FormData;a.append("title",d),a.append("content",i),a.append("published","1"),a.append("pinHome",t?"1":"0"),T&&a.append("imageFile",T);try{m(!0),await we({controller:"Blog",data:a}),h({title:"Đăng bài thành công!",status:"success",duration:2e3,position:"top",variant:"left-accent",isClosable:!0}),S(),W(),p()}catch(I){h({title:"Lỗi khi đăng bài.",description:I.message||"Không thể gửi bài",status:"error",duration:3e3,position:"top",variant:"left-accent",isClosable:!0})}finally{m(!1)}},H=()=>{M?C():(S(),p())},V=()=>{S(),v(),p()};return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{isOpen:P,onClose:H,size:"6xl",isCentered:!0,scrollBehavior:"inside",motionPreset:"slideInBottom",children:[e.jsx(_,{}),e.jsxs(ae,{children:[e.jsxs(G,{children:[e.jsxs(L,{children:[e.jsx(N,{textAlign:"center",fontWeight:"bold",fontSize:"2xl",children:"Đăng bài viết mới"}),e.jsx(ie,{placeholder:"Nhập tiêu đề bài viết",value:d,onChange:a=>b(a.target.value),autoFocus:!0})]}),e.jsxs(c,{align:"center",mt:4,bgGradient:"linear(to-r, blue.500, blue.400)",p:2,borderRadius:"lg",children:[e.jsx(oe,{src:f,mr:3}),e.jsx(F,{color:"white",fontWeight:"bold",children:A})]})]}),e.jsx(le,{}),e.jsx(U,{children:e.jsxs(o,{mb:3,children:[e.jsxs(L,{mb:6,children:[e.jsx(N,{textAlign:"center",fontWeight:"bold",children:"Ảnh đại diện"}),e.jsx(Ce,{label:"chọn ảnh đại diện",previewWidth:"80vh",previewHeight:"40vh",onImageChange:a=>z(a)})]}),e.jsxs(L,{children:[e.jsx(N,{fontWeight:"bold",children:"Nội dung"}),e.jsx(re,{value:i,onChange:B,modules:Se,formats:ve,theme:"snow",placeholder:"Chia sẻ cảm nghĩ của bạn hoặc thêm hình ảnh vào nội dung..."})]})]})}),e.jsxs(q,{justifyContent:"space-between",children:[e.jsx(c,{gap:4,flex:1,children:e.jsxs(L,{display:"flex",alignItems:"center",children:[e.jsx(N,{htmlFor:"pinHome",mb:"0",fontWeight:"bold",children:"Ghim ở trang chủ"}),e.jsx(ce,{id:"pinHome",isChecked:t,onChange:a=>j(a.target.checked)})]})}),e.jsxs(o,{children:[e.jsx(g,{variant:"ghost",mr:3,onClick:H,children:"Hủy"}),e.jsx(g,{colorScheme:"blue",onClick:R,isLoading:D,loadingText:"Đang đăng bài...",children:"Đăng bài"})]})]})]})]}),e.jsx(de,{isOpen:k,leastDestructiveRef:l,onClose:v,isCentered:!0,children:e.jsx(_,{children:e.jsxs(he,{children:[e.jsx(G,{fontSize:"lg",fontWeight:"bold",children:"Cảnh báo"}),e.jsx(U,{children:"Bạn có chắc chắn muốn bỏ tạo bài mới?"}),e.jsxs(q,{children:[e.jsx(g,{ref:l,onClick:v,children:"Tiếp tục chỉnh sửa"}),e.jsx(g,{colorScheme:"red",onClick:V,ml:3,children:"Hủy"})]})]})})})]})},Ge=()=>{ye("Bài viết");const P=ge(),{isOpen:p,onOpen:W,onClose:A}=Y(),[f,d]=n.useState(!1),b=X(),{coder:i,isAuthenticated:B}=Be(),[t,j]=n.useState(null),[T,z]=n.useState([]),[l,D]=n.useState([]),[m,k]=n.useState(1),[C,v]=n.useState(10),[h,M]=n.useState(0),[S,R]=n.useState(0),H=async(s=1,u=10,w=[])=>{try{const r=await Q.get("/Blog/Latest",{params:{page:s,pageSize:u,excludedIds:w.join(",")}});if(r.status===200)return r.data}catch(r){throw r}},V=async(s=3)=>{try{return(await Q.get(`/Blog/TopViewed?count=${s}`)).data}catch(u){throw u}},a=async()=>{try{const s=await V();D(s||[])}catch(s){b({title:"Lỗi khi tải bài viết phổ biến",description:s.message||"Không thể tải dữ liệu",status:"error",duration:3e3,isClosable:!0,variant:"top-accent",position:"top"})}},I=async(s,u)=>{d(!0);try{const w=l.map(K=>K.blogID),r=await H(s,u,w),O=r.data||[];if(M(r.totalPages),R(r.totalCount),O.length>0){j(O[0]);const K=O.slice(1),ee=(te=>{const x=[...te];for(let y=x.length-1;y>0;y--){const $=Math.floor(Math.random()*(y+1));[x[y],x[$]]=[x[$],x[y]]}return x})(K);z(ee)}else j(null),z([])}catch(w){b({title:"Lỗi khi tải bài viết mới nhất",description:w.message||"Không thể tải dữ liệu",status:"error",duration:3e3,isClosable:!0,variant:"top-accent",position:"top"})}finally{d(!1)}};n.useEffect(()=>{l.length===0&&a()},[]),n.useEffect(()=>{l.length>0&&I(m,C)},[m,C,l]);const Z=s=>{s>=1&&s<=h&&k(s)},J=s=>{v(s),k(1)};return e.jsx(Te,{children:e.jsx(o,{bg:"gray.200",children:e.jsxs(me,{maxW:"8xl",py:8,minH:"86vh",children:[B&&e.jsx(c,{align:"center",justify:"end",children:e.jsx(g,{colorScheme:"blue",onClick:W,children:"Đăng bài mới"})}),e.jsx(Ae,{isOpen:p,onClose:A,onSuccess:I,authorName:(i==null?void 0:i.coderName)||"Nguyễn Thiết Duy Đan",authorAvatar:(i==null?void 0:i.avatar)||"https://i.pravatar.cc/150?img=10"}),e.jsxs(c,{gap:8,mb:8,flexWrap:{base:"wrap",md:"nowrap"},children:[e.jsxs(o,{flex:"0.8",minW:{base:"100%",md:"0"},mb:{base:6,md:0},children:[e.jsx(E,{size:{base:"sm",md:"md"},fontWeight:"bold",mb:4,textTransform:"uppercase",children:"Bài viết mới nhất"}),e.jsx(o,{bg:"white",p:6,rounded:"md",shadow:"md",children:f?e.jsx(c,{justify:"center",align:"center",height:"70vh",children:e.jsx(ue,{})}):t?e.jsxs(o,{minH:"80vh",children:[e.jsxs(c,{align:"center",mb:5,children:[e.jsx(ze,{size:"md",name:t.coderName||t.CoderName||t.author||"Người dùng",src:t.avatarCoder||"",mr:2}),e.jsxs(o,{children:[e.jsx(g,{variant:"link",colorScheme:"black",onClick:()=>P(`/profile/${t.coderID}`),children:e.jsx(F,{fontWeight:"bold",fontSize:"lg",children:t.coderName||t.CoderName||t.author||"Người dùng"})}),e.jsxs(c,{align:"center",gap:3,mt:1,children:[e.jsx(F,{fontSize:"sm",color:"gray.500",children:ke(t.blogDate||t.BlogDate)}),e.jsxs(xe,{colorScheme:"blue",display:"flex",alignItems:"center",fontSize:"0.75rem",px:2,children:[e.jsx(pe,{as:fe,mr:2}),He(t.viewCount||t.ViewCount||0)," lượt xem"]})]})]})]}),e.jsx(o,{children:e.jsx(be,{size:"md",name:t.title||t.Title||"Không có ảnh",src:t.imageBlogUrl||"./avatarSimmmple.png",w:"100%",maxH:"340px",objectFit:"cover",alt:t.title||t.Title||"Không có ảnh",fallbackSrc:"./avatarSimmmple.png",borderRadius:"md",mb:4,loading:"lazy"})}),e.jsxs(c,{direction:"column",children:[e.jsx(je,{to:`/blogs/${Ie(t.title||t.Title)}-${t.blogID}`,children:e.jsx(g,{variant:"link",colorScheme:"black",fontSize:{base:"md",md:"lg",xl:"xl"},fontWeight:"bold",mb:{base:2,md:3},whiteSpace:"normal",textAlign:"left",px:0,children:t.title||t.Title||"Không có tiêu đề"})}),e.jsx(o,{whiteSpace:"pre-wrap",fontSize:{base:"sm",md:"md"},mb:{base:3,md:4},wordBreak:"break-word",dangerouslySetInnerHTML:{__html:Le(Ne(t.content||t.Content||"",200))}})]})]}):e.jsx(o,{minH:"70vh",display:"flex",justifyContent:"center",alignItems:"center",children:e.jsx(F,{children:"Chưa có bài viết nào."})})})]}),e.jsxs(o,{flex:"1",maxHeight:"max-content",display:"flex",flexDirection:"column",children:[e.jsx(E,{size:{base:"sm",md:"md"},mb:4,textTransform:"uppercase",children:"Các bài viết nổi bật"}),e.jsx(We,{blogs:l,loading:f})]})]}),e.jsx(E,{fontSize:"xl",fontWeight:"bold",mb:4,textTransform:"uppercase",children:"Các bài viết trước đó"}),e.jsx(o,{minH:"40vh",children:e.jsx(Pe,{blogs:T,loading:f})}),e.jsx(Fe,{currentPage:m,totalPages:h,totalRows:S,onPageChange:Z,pageSize:C,onPageSizeChange:J})]})})})};export{Ge as default};
